{{ 'component-cart.css' | asset_url | stylesheet_tag }}
{{ 'component-cart-items.css' | asset_url | stylesheet_tag }}
{{ 'component-totals.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-discounts.css' | asset_url | stylesheet_tag }}
{{ 'quantity-popover.css' | asset_url | stylesheet_tag }}

{%- unless settings.cart_type == 'drawer' -%}
  <script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>
{%- endunless -%}

<script src="{{ 'quantity-popover.js' | asset_url }}" defer="defer"></script>

<cart-items class="gradient color-{{ section.settings.color_scheme }} isolate{% if cart == empty %} is-empty{% else %} section-{{ section.id }}-padding{% endif %}">
  <div class="page-width">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-10">
      <h1 class="text-2.4 md:text-2.8 font-semibold text-[#01635D] tracking-tight">
        {{ 'sections.cart.title' | t }}
      </h1>

      <a
        href="{{ routes.all_products_collection_url }}"
        class="inline-flex items-center text-1.4 font-medium text-[#01A89E] hover:text-[#01635D] transition-colors duration-200 group"
      >
        {{ 'general.continue_shopping' | t }}
        <span class="ml-2 inline-block transform group-hover:translate-x-1 transition-transform duration-200">
          <svg
            width="1.4rem"
            height="1.4rem"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
      </a>
    </div>

    {% if cart.empty? %}
      <div class="text-center py-12 px-6">
        <h1 class="text-2 font-medium text-gray-900 mb-6">
          {{ 'sections.cart.empty' | t }}
        </h1>
        <a
          href="{{ routes.all_products_collection_url }}"
          class="inline-flex items-center justify-center px-5 py-2.5 border border-transparent text-md font-medium rounded-[0.4rem] text-white bg-gradient-to-r from-[#01756E] via-[#01A89E] to-[#00CFC8] hover:from-[#01635D] hover:via-[#018F87] hover:to-[#00B8B2] shadow-md transition-all duration-150 ease-out hover:ease-in hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[#01A89E]"
        >
          {{ 'general.continue_shopping' | t }}
        </a>
      </div>
    {% else %}
      <form
        action="{{ routes.cart_url }}"
        class="cart__contents critical-hidden"
        method="post"
        id="cart"
      >
        <div
          class="cart__items"
          id="main-cart-items"
          data-id="{{ section.id }}"
        >
          <div class="js-contents">
            {% if settings['enable-free-shipping-progress'] %}
              <!-- Free shipping progress bar remains unchanged -->
            {% endif %}

            {%- comment -%} Group items by product type {%- endcomment -%}
            {%- assign product_types = cart.items
              | map: 'product'
              | map: 'type'
              | uniq
            -%}

            {%- for type in product_types -%}
              {%- comment -%} This is the reliable way to filter by product type {%- endcomment -%}

              <div class="mb-12 border border-gray-200 rounded-lg overflow-hidden">
                <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
                  <h3 class="text-1.6 font-semibold text-[#01756E]">
                    {%- if type == blank -%}
                      Others
                    {%- else -%}
                      {{ type }}
                    {%- endif -%}
                  </h3>
                </div>

                <table class="w-full">
                  <thead class="border-b border-gray-200">
                    <tr>
                      <th
                        class="text-left py-4 px-6 font-medium text-gray-700"
                        colspan="1"
                      >
                        Product
                      </th>
                      <th
                        class="text-start py-4 px-6 font-medium text-gray-700 small-hide"
                        colspan="1"
                      >
                        Quantity
                      </th>
                      <th
                        class="text-end py-4 px-6 font-medium text-gray-700"
                        colspan="1"
                      >
                        Total
                      </th>
                    </tr>
                  </thead>

                  <tbody>
                    {%- for item in cart.items -%}
                      {%- if item.product.type == type -%}
                        <tr
                          class="border-b border-gray-100 hover:bg-gray-50 transition-colors duration-150"
                          id="CartItem-{{ item.index | plus: 1 }}"
                        >
                          <td class="py-4 px-6">
                            <div class="flex gap-4">
                              <div>
                                {% if item.image %}
                                  <div class="w-40 h-40 rounded overflow-hidden border border-gray-100">
                                    <img
                                      src="{{ item.image | image_url: width: 300 }}"
                                      class="w-full h-full object-cover"
                                      alt="{{ item.image.alt | escape }}"
                                      loading="lazy"
                                      width="150"
                                      height="{{ 150 | divided_by: item.image.aspect_ratio | ceil }}"
                                    >
                                  </div>
                                {% endif %}
                              </div>
                              <div>
                                {%- if settings.show_vendor -%}
                                  <p class="text-gray-500 mb-1">
                                    {{ item.product.vendor }}
                                  </p>
                                {%- endif -%}

                                <a
                                  href="{{ item.url }}"
                                  class="text-gray-900 hover:text-[#01756E] transition-colors duration-150 font-medium"
                                >
                                  {{- item.product.title | escape -}}
                                </a>

                                {%- if item.original_price != item.final_price
                                -%}
                                  <div class="mt-1">
                                    <s class="text-gray-500">
                                      {{- item.original_price | money -}}
                                    </s>
                                    <span class="ml-2 font-medium text-[#01756E]">
                                      {{- item.final_price | money -}}
                                    </span>
                                  </div>
                                {%- else -%}
                                  <div class="mt-1 text-[#01756E] font-medium">
                                    {{ item.original_price | money }}
                                  </div>
                                {%- endif -%}

                                {%- if item.product.has_only_default_variant
                                    == false
                                  or item.properties.size != 0
                                  or item.selling_plan_allocation != null
                                -%}
                                  <dl class="mt-2 space-y-1 text-sm text-gray-600">
                                    {%- if item.product.has_only_default_variant
                                        == false
                                    -%}
                                      {%- for option in item.options_with_values -%}
                                        <div class="flex">
                                          <dt class="font-medium text-gray-700 mr-1">
                                            {{ option.name }}:
                                          </dt>
                                          <dd>{{ option.value }}</dd>
                                        </div>
                                      {%- endfor -%}
                                    {%- endif -%}

                                    {%- for property in item.properties -%}
                                      {%- assign property_first_char = property.first
                                        | slice: 0
                                      -%}
                                      {%- if property.last != blank
                                        and property_first_char != '_'
                                      -%}
                                        <div class="flex">
                                          <dt class="font-medium text-gray-700 mr-1">
                                            {{ property.first }}:
                                          </dt>
                                          <dd>
                                            {%- if property.last
                                                contains '/uploads/'
                                            -%}
                                              <a
                                                href="{{ property.last }}"
                                                class="text-[#01A89E] hover:text-[#01756E]"
                                                target="_blank"
                                              >
                                                {{
                                                  property.last
                                                  | split: '/'
                                                  | last
                                                }}
                                              </a>
                                            {%- else -%}
                                              {{ property.last }}
                                            {%- endif -%}
                                          </dd>
                                        </div>
                                      {%- endif -%}
                                    {%- endfor -%}
                                  </dl>
                                {%- endif -%}

                                {%- if item.selling_plan_allocation != null -%}
                                  <p class="mt-2 text-sm text-gray-600">
                                    {{ item.selling_plan_allocation.selling_plan.name }}
                                  </p>
                                {%- endif -%}

                                <ul class="mt-2 space-y-1">
                                  {%- for discount in item.line_level_discount_allocations -%}
                                    <li class="text-[#01A89E] flex items-center">
                                      {%- render 'icon-discount' -%}
                                      <span class="ml-1">
                                        {{- discount.discount_application.title -}}
                                      </span>
                                    </li>
                                  {%- endfor -%}
                                </ul>
                                <div class="mt-2 750:hidden">
                                  <quantity-popover>
                                    <div class="flex items-center">
                                      <quantity-input class="flex items-center border border-gray-200 rounded">
                                        <button
                                          class="quantity__button no-js-hidden w-10 h-10 flex items-center justify-center text-[#01756E] hover:text-[#01A89E] hover:bg-gray-100 transition-colors duration-150"
                                          name="minus"
                                          type="button"
                                        >
                                          <span class="visually-hidden">
                                            {{-
                                              'products.product.quantity.decrease'
                                              | t: product: item.product.title
                                              | escape
                                            -}}
                                          </span>
                                          {% render 'icon-minus' %}
                                        </button>
                                        <input
                                          class="w-12 h-10 text-center border-x border-gray-200"
                                          type="number"
                                          name="updates[]"
                                          value="{{ item.quantity }}"
                                          min="{{ item.variant.quantity_rule.min }}"
                                          {% if item.variant.quantity_rule.max
                                              != null
                                          %}
                                            max="{{ item.variant.quantity_rule.max }}"
                                          {% endif %}
                                          step="{{ item.variant.quantity_rule.increment }}"
                                          data-index="{{ item.index | plus: 1 }}"
                                        >

                                        <button
                                          class="quantity__button no-js-hidden w-10 h-10 flex items-center justify-center text-[#01756E] hover:text-[#01A89E] hover:bg-gray-100 transition-colors duration-150"
                                          name="plus"
                                          type="button"
                                        >
                                          <span class="visually-hidden">
                                            {{-
                                              'products.product.quantity.increase'
                                              | t: product: item.product.title
                                              | escape
                                            -}}
                                          </span>
                                          {% render 'icon-plus' %}
                                        </button>
                                      </quantity-input>
                                      <a
                                        href="{{ item.url_to_remove }}"
                                        class="ml-2 w-10 h-10 flex items-center justify-center text-[#01756E] hover:text-[#01A89E] hover:bg-gray-100 rounded transition-colors duration-150"
                                        aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                                        id="Remove-{{ item.index | plus: 1 }}"
                                        data-index="{{ item.index | plus: 1 }}"
                                      >
                                        {% render 'icon-remove' %}
                                      </a>
                                    </div>
                                  </quantity-popover>
                                </div>
                              </div>
                            </div>
                          </td>

                          <td class="py-4 !px-0 small-hide">
                            <quantity-popover>
                              <div class="flex items-center">
                                <quantity-input class="flex items-center border border-gray-200 rounded">
                                  <button
                                    class="quantity__button no-js-hidden w-10 h-10 flex items-center justify-center text-[#01756E] hover:text-[#01A89E] hover:bg-gray-100 transition-colors duration-150"
                                    name="minus"
                                    type="button"
                                  >
                                    <span class="visually-hidden">
                                      {{-
                                        'products.product.quantity.decrease'
                                        | t: product: item.product.title
                                        | escape
                                      -}}
                                    </span>
                                    {% render 'icon-minus' %}
                                  </button>
                                  <input
                                    class="w-12 h-10 text-center border-x border-gray-200"
                                    type="number"
                                    name="updates[]"
                                    value="{{ item.quantity }}"
                                    min="{{ item.variant.quantity_rule.min }}"
                                    {% if item.variant.quantity_rule.max != null
                                    %}
                                      max="{{ item.variant.quantity_rule.max }}"
                                    {% endif %}
                                    step="{{ item.variant.quantity_rule.increment }}"
                                    data-index="{{ item.index | plus: 1 }}"
                                  >

                                  <button
                                    class="quantity__button no-js-hidden w-10 h-10 flex items-center justify-center text-[#01756E] hover:text-[#01A89E] hover:bg-gray-100 transition-colors duration-150"
                                    name="plus"
                                    type="button"
                                  >
                                    <span class="visually-hidden">
                                      {{-
                                        'products.product.quantity.increase'
                                        | t: product: item.product.title
                                        | escape
                                      -}}
                                    </span>
                                    {% render 'icon-plus' %}
                                  </button>
                                </quantity-input>
                                <a
                                  href="{{ item.url_to_remove }}"
                                  class="ml-2 w-10 h-10 flex items-center justify-center text-[#01756E] hover:text-[#01A89E] hover:bg-gray-100 rounded transition-colors duration-150"
                                  aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                                  id="Remove-{{ item.index | plus: 1 }}"
                                  data-index="{{ item.index | plus: 1 }}"
                                >
                                  {% render 'icon-remove' %}
                                </a>
                              </div>
                            </quantity-popover>
                          </td>

                          <td class="py-4 px-6 text-right">
                            {%- if item.original_line_price
                                != item.final_line_price
                            -%}
                              <div>
                                <s class="text-gray-500">
                                  {{- item.original_line_price | money -}}
                                </s>
                                <div class="font-medium text-[#01756E]">
                                  {{ item.final_line_price | money }}
                                </div>
                              </div>
                            {%- else -%}
                              <div class="font-medium text-[#01756E]">
                                {{ item.original_line_price | money }}
                              </div>
                            {%- endif -%}
                          </td>
                        </tr>
                      {%- endif -%}
                    {%- endfor -%}
                  </tbody>
                </table>
              </div>
            {%- endfor -%}
          </div>
        </div>
        <p
          class="visually-hidden"
          id="cart-live-region-text"
          aria-live="polite"
          role="status"
        ></p>
        <p
          class="visually-hidden"
          id="shopping-cart-line-item-status"
          aria-live="polite"
          aria-hidden="true"
          role="status"
        >
          {{ 'accessibility.loading' | t }}
        </p>
      </form>
    {% endif %}
  </div>
</cart-items>
